sequenceDiagram
    participant Client
    participant Gateway
    participant UserService as algoshare-user-payment
    participant Stripe as External Payment Gateway

    Client->>Gateway: POST /api/wallet/add-funds {amount: 1000}
    Gateway->>UserService: Forward (with X-User-Id)
    UserService->>Stripe: Create Payment Intent
    Stripe-->>UserService: Intent Secret
    UserService-->>Client: Return Secret (for UI Popup)

    Note over Client, Stripe: User pays on UI...

    Stripe->>Gateway: Webhook POST /api/payment/webhook
    Gateway->>UserService: Forward Webhook
    UserService->>UserService: Verify & Update Wallet Balance