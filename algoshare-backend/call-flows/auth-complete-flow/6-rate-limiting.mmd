graph TB
    F1[Redis Key Structure] --> F2[ratelimit:register:ip:192.168.1.1]
    F1 --> F3[ratelimit:login:ip:192.168.1.1]
    F1 --> F4[ratelimit:otp-verify:session:xyz789]
    F1 --> F5[ratelimit:api:user:userId123]

    F6[Token Bucket State] --> F7[tokens: 95]
    F6 --> F8[lastRefill: 1736534400]
    F6 --> F9[TTL: 3600 seconds]
